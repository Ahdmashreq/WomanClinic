{% extends 'master.html'%}
{% load static %}
{% load crispy_forms_tags %}
{% load i18n %}
{% load l10n %}
{% block body %}

<div class="col-xl-12">
  <form id="my_form" method="POST" enctype="multipart/form-data">
    {% csrf_token %}
    {% include 'messages.html' %}
    <p>
      <button type="submit" class="btn btn-success">حفظ</button>
      <a href="{% url 'patient:view-patient' pk=required_patient.id %}" class="btn btn-secondary">{% trans "الغاء" %}</a>
    </p>
    <div class="card">
      <div class="card-header">{{ page_title }}</div>
      <div class="card-body">
        <div class="row show-grid">
          <div class="col-md-3">
            {{ diabete_form.bs|as_crispy_field}}
          </div>
          <div class="col-md-3">
            {{ diabete_form.bp_up|as_crispy_field}}
          </div>
          <div class="col-md-3">
            {{ diabete_form.bp_down|as_crispy_field}}
          </div>
          <div class="col-md-3">
            {{ diabete_form.temp|as_crispy_field}}
          </div>
          <div class="col-md-3">
            {{ diabete_form.reading_date|as_crispy_field}}
          </div>
        </div>
      </div>
      <!-- /.card-body -->
    </div>
    <!-- /.panel -->
  </form>
  <div class="row">
    <div class="col-lg-6">
      <div class="card">
        <div class="card-body">
          <table class="table" id="dataTable">
            <thead style="background-color: #89acbdb3;">
              <tr role="row">
                <th style="text-align:center;">#</th>
                <th style="text-align:center;">التاريخ</th>
                <th style="text-align:center;">سكر الدم</th>
                <th colspan="2" style="text-align:center;">ضغط الدم</th>
                <th style="text-align:center;">درجة الحرارة</th>
              </tr>
            </thead>
            <tbody>
              {% for check in list_diabetes %}
              <tr>
                <th scope="row">{{ forloop.counter }}</th>
                <td>{{check.reading_date}}</td>
                <td>{{check.bs}}</td>
                <td>{{check.bp_up}}</td>
                <td>{{check.bp_down}}</td>
                <td>{{check.temp}}</td>
              </tr>
              {% endfor %}
          </table>
        </div>
      </div>
    </div>
    <div class="col-lg-6">
      <div class="card">
        <div class="card-body">
          <canvas id="patients-diabetes-chart" data-url="{% url 'patient:patients-diabetes-chart' patient_id=required_patient.id %}"></canvas>
        </div>
      </div>
    </div>
  </div>
</div>
<!--  -->
<script src="https://code.jquery.com/jquery-3.4.1.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/chart.js@2.9.3/dist/Chart.min.js"></script>
<script>
  $(function() {
    var $populationChart = $("#patients-diabetes-chart");
    $.ajax({
      url: $populationChart.data("url"),
      success: function(data) {

        var ctx = $populationChart[0].getContext("2d");

        new Chart(ctx, {
          type: 'line',
          data: {
            labels: data.labels,
            datasets: [{
              label: 'سكر المريضة',
              backgroundColor: 'red',
              borderColor: 'red',
              data: data.bs,
              fill:false,
            },{
              label: 'SBP',
              backgroundColor: 'blue',
              borderColor: 'blue',
              data: data.bp_up,
              fill:false,
            },{
              label: 'DBP',
              backgroundColor: 'orange',
              borderColor: 'orange',
              data: data.bp_down,
              fill:false,
            }
          ],
          },
          options: {
            responsive: true,
            scales: {
					xAxes: [{
						display: true,
						scaleLabel: {
							display: true,
							labelString: 'Month'
						}
					}],
					yAxes: [{
						display: true,
						scaleLabel: {
							display: true,
							labelString: 'Value'
						}
					}]
				},
            legend: {
              position: 'top',
            },
            title: {
              display: true,
              text: 'رسم بياني للمتابعة الدورية للمريضة'
            }
         }
        });
      }
    });
  });
</script>
{% endblock body %}
